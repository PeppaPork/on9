<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<style>
	canvas {
		border: 5px dashed #85144b;
		background-color: #001f3f;
		border-radius: 5px;
	}
</style>
</head>
<body onload="startGame()">
<script>
	function startGame() {	
		snakeHead = new component(20, 20, "#01FF70", 140, 100);
		snakeBody = [];
		food =  new component(20, 20, "#FF4136", 140, 140);
		ateFood = false;
		snakeArea.start();
		genFood();
	}

	function component(width, height, color, x, y, dir=0) {
		this.width = width;
		this.height = height;
		this.speed = 20;
		this.direction = dir;
		this.x = x;
		this.y = y;
		this.update = function(){
			ctx = snakeArea.context;
			ctx.fillStyle = color;
			ctx.fillRect(this.x, this.y, this.width, this.height);
		}
		this.newPos = function(){
			if (this.direction == 0) {this.y -= this.speed;}
			if (this.direction == 1) {this.x += this.speed;}
			if (this.direction == 2) {this.y += this.speed;}
			if (this.direction == 3) {this.x -= this.speed;}			
		}
		this.ateFoodCheck = function() {
			if (this.x == food.x && this.y == food.y) {
				ateFood = true;
				addSnakeBody();
				genFood();
			}			
		}
	}
	
	function updateSnakeBody() {
		if (snakeBody.length > 0){
			for (i = snakeBody.length-1 ; i > 0 ; i -= 1){
				snakeBody[i].direction = snakeBody[i-1].direction;
			}
			snakeBody[0].direction = snakeHead.direction;			
		}		
	}
	
	function addSnakeBody() {
		var originalX=0;
		var	originalY=0;
		var originalDir=0;
		if (snakeBody.length > 0){
			originalDir = snakeBody[snakeBody.length-1].direction;
			originalX = snakeBody[snakeBody.length-1].x;
			originalY = snakeBody[snakeBody.length-1].y;				
		} else {
			originalDir = snakeHead.direction;
			originalX = snakeHead.x;
			originalY = snakeHead.y;			
		}
		if (originalDir == 0){originalY += -20;}
		if (originalDir == 1){originalX += -20;}				
		if (originalDir == 2){originalY += 20;}
		if (originalDir == 3){originalX += 20;}
		snakeBody.push(new component(20, 20, "#01FF70", originalX, originalY, originalDir));
		ateFood = false;
	}
	
	function genFood() {
        randX = Math.floor(Math.random() * (14 - 0) ) + 0;
        randY = Math.floor(Math.random() * (11 - 0) ) + 0;		
        food.x = randX*20;
		food.y = randY*20;
	}
	
	function updateSnakeArea () {
		updateSnakeBody();
		if (snakeArea.key && snakeArea.key == 37 && snakeHead.direction != 1) {snakeHead.direction = 3; }
		if (snakeArea.key && snakeArea.key == 39 && snakeHead.direction != 3) {snakeHead.direction = 1; }
		if (snakeArea.key && snakeArea.key == 38 && snakeHead.direction != 2) {snakeHead.direction = 0; }
		if (snakeArea.key && snakeArea.key == 40 && snakeHead.direction != 0) {snakeHead.direction = 2; }
		snakeHead.newPos();	
		if (snakeHead.x < 0 || snakeHead.x > 280 || snakeHead.y < 0 || snakeHead.y > 220) {snakeArea.stop();	return;}
		snakeArea.clear();
		snakeHead.update();
		food.update();
		for (i = 0 ; i < snakeBody.length ; i += 1) {
			snakeBody[i].newPos();			
			snakeBody[i].update();
		}
		snakeHead.ateFoodCheck();
	}
	
	var snakeArea = {
		canvas : document.createElement("canvas"),
		start : function() {
			this.canvas.width = 300;
			this.canvas.height = 240;
			this.context = this.canvas.getContext("2d");
			document.body.insertBefore(this.canvas, document.body.childNodes[0]);
			this.interval = setInterval(updateSnakeArea, 100);
			window.addEventListener('keydown', function (e) {
				snakeArea.key = e.keyCode;
			})
			window.addEventListener('keyup', function (e) {
				snakeArea.key = false;
			})			
		},
		clear : function() {
			this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
		},
		stop : function() {
			clearInterval(this.interval);
		}
	}
</script>

</body>
</html>
